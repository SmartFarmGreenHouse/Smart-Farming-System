<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Farming System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <style>
    /* General Styles */
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease-in-out;
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }
    .column-title {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: white;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    @media (min-width: 768px) {
      .column-title {
        font-size: 1.25rem;
        margin-bottom: 1.5rem;
      }
      .card {
        padding: 1.5rem;
      }
    }

    /* Switch Toggle */
    .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #2563eb; }
    input:checked + .slider:before { transform: translateX(22px); }
    .switch.mx-auto { margin-left: auto; margin-right: auto; }

    @media (min-width: 768px) {
      .switch { width: 60px; height: 34px; }
      .slider:before { height: 26px; width: 26px; }
      input:checked + .slider:before { transform: translateX(26px); }
    }

    /* Status Indicators */
    .status-active { background: linear-gradient(45deg, #10B981, #059669); color: white; }
    .status-inactive { background: linear-gradient(45deg, #EF4444, #DC2626); color: white; }
    .logic-true { background: linear-gradient(45deg, #D1FAE5, #A7F3D0); color: #065F46; }
    .logic-false { background: linear-gradient(45deg, #FEE2E2, #FECACA); color: #991B1B; }
    
    /* Login Form */
    .login-error { color: #EF4444; font-size: 0.875rem; margin-top: 0.5rem; }

    /* Futuristic Set Point Controls */
    .setpoint-container {
      background: linear-gradient(145deg, #1e293b, #334155);
      border-radius: 1rem;
      padding: 1rem;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.1);
      border: 1px solid rgba(148, 163, 184, 0.3);
    }
    @media (min-width: 768px) {
      .setpoint-container {
        padding: 1.5rem;
      }
    }
    .setpoint-value {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(45deg, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
      margin-bottom: 1rem;
      text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
    }
    @media (min-width: 768px) {
      .setpoint-value {
        font-size: 2.5rem;
      }
    }
    .setpoint-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      justify-content: center;
    }
    @media (min-width: 768px) {
      .setpoint-controls {
        gap: 1rem;
      }
    }
    .setpoint-btn {
      width: 35px;
      height: 35px;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: bold;
      color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }
    @media (min-width: 768px) {
      .setpoint-btn {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
      }
    }
    .setpoint-btn:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }
    .setpoint-btn:hover:before { transform: translateX(100%); }
    .setpoint-btn.decrease { background: linear-gradient(45deg, #ef4444, #dc2626); }
    .setpoint-btn.increase { background: linear-gradient(45deg, #10b981, #059669); }
    .setpoint-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.3); }
    .setpoint-btn:active { transform: translateY(0); }
    .setpoint-slider {
      flex: 1;
      height: 6px;
      background: linear-gradient(90deg, #1e293b, #334155);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }
    .setpoint-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: linear-gradient(45deg, #3b82f6, #8b5cf6);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
      transition: all 0.3s ease;
    }
    @media (min-width: 768px) {
      .setpoint-slider::-webkit-slider-thumb {
        width: 20px;
        height: 20px;
      }
    }
    .setpoint-slider::-webkit-slider-thumb:hover { transform: scale(1.2); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.6); }
    .setpoint-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: linear-gradient(45deg, #3b82f6, #8b5cf6);
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.4);
    }
    @media (min-width: 768px) {
      .setpoint-slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
      }
    }
    .setpoint-label {
      color: #94a3b8;
      font-size: 0.8rem;
      text-align: center;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    @media (min-width: 768px) {
      .setpoint-label {
        font-size: 0.875rem;
      }
    }

    /* Glowing effect for active elements */
    .glow-active {
      animation: glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
      to { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6); }
    }

    /* Pump Control Special Styling */
    .pump-control-card {
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(255, 255, 255, 0.92));
      border: 2px solid rgba(79, 70, 229, 0.3);
      box-shadow: 0 8px 32px rgba(79, 70, 229, 0.2);
    }
    .pump-control-card:hover {
      border-color: rgba(79, 70, 229, 0.5);
      box-shadow: 0 12px 40px rgba(79, 70, 229, 0.3);
    }
  </style>
</head>
<body class="min-h-screen">
  <div class="container mx-auto py-4 sm:py-6 md:py-8 px-3 sm:px-4">
    <h1 class="text-xl sm:text-2xl md:text-3xl font-extrabold text-center mb-3 sm:mb-4 md:mb-6 text-white tracking-tight" style="text-shadow: 0 4px 8px rgba(0,0,0,0.3);">
      Smart Farming System
    </h1>

    <div id="loginForm" class="max-w-sm mx-auto bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-xl font-bold mb-4 text-center">Login</h2>
      <input type="email" id="email" placeholder="Enter Email" class="w-full mb-4 p-2 border rounded">
      <input type="password" id="password" placeholder="Enter Password" class="w-full mb-4 p-2 border rounded">
      <button id="loginBtn" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Login</button>
      <div id="loginError" class="login-error" style="display: none;"></div>
    </div>

    <div id="dashboard" style="display:none">
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 max-w-7xl mx-auto">
        <div class="flex flex-col items-center w-full">
          <h2 class="column-title">Group 1</h2>
          <div id="col-group1" class="space-y-3 sm:space-y-4 md:space-y-6 w-full"></div>
        </div>
        <div class="flex flex-col items-center w-full">
          <h2 class="column-title">Group 2</h2>
          <div id="col-group2" class="space-y-3 sm:space-y-4 md:space-y-6 w-full"></div>
        </div>
        <div class="flex flex-col items-center w-full">
          <h2 class="column-title">Group 3</h2>
          <div id="col-group3" class="space-y-3 sm:space-y-4 md:space-y-6 w-full"></div>
        </div>
      </div>

      <!-- Pump Control Card - Now positioned above global controls -->
      <div class="mt-6 sm:mt-8 flex justify-center">
        <div class="w-full max-w-sm">
          <div id="pumpControlCard" class="card pump-control-card text-center">
            <h4 class="font-semibold mb-2 text-center text-gray-700">Pump Control</h4>
            <p class="text-sm text-gray-500 mb-3">Main Pump</p>
            <div class="mt-auto">
              <p class="mb-3 text-sm sm:text-base">Status: <span id="m-status" class="font-bold">Loading...</span></p>
              <label class="switch mx-auto">
                <input type="checkbox" id="m-control">
                <span class="slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 sm:mt-8 text-center max-w-lg mx-auto">
        <div class="flex flex-col sm:flex-row justify-center items-center gap-3 sm:gap-4">
          <button id="allOnBtn" class="w-full sm:w-auto bg-green-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-green-600 transition text-sm sm:text-base">All ON</button>
          <button id="allOffBtn" class="w-full sm:w-auto bg-red-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-red-600 transition text-sm sm:text-base">All OFF</button>
          <button id="logoutBtn" class="w-full sm:w-auto bg-gray-600 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-gray-700 transition text-sm sm:text-base">Logout</button>
        </div>
      </div>
    </div>
  </div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyARnsUK3fcLTOAzjtykzH1Pr4670N_iU4M",
      authDomain: "smart-farming-system2.firebaseapp.com",
      databaseURL: "https://smart-farming-system2-default-rtdb.firebaseio.com",
      projectId: "smart-farming-system2",
      storageBucket: "smart-farming-system2.firebasestorage.app",
      messagingSenderId: "17039270358",
      appId: "1:17039270358:web:9181931f9a46cc03590477"
    };
    firebase.initializeApp(firebaseConfig);

    const allowedEmail = "admin321@gmail.com";
    const allowedPassword = "123456789";

    const loginForm = document.getElementById("loginForm");
    const dashboard = document.getElementById("dashboard");
    const loginBtn = document.getElementById("loginBtn");
    const loginError = document.getElementById("loginError");
    const logoutBtn = document.getElementById("logoutBtn");

    let sensorData = {};
    let relayStates = {};
    let setPointValues = { group1: 30, group2: 30, group3: 30 };

    loginBtn.addEventListener("click", () => {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;
      loginError.style.display = 'none';
      if (!email || !password) {
        showLoginError("Please enter both email and password");
        return;
      }
      if (email === allowedEmail && password === allowedPassword) {
        loginForm.style.display = 'none';
        dashboard.style.display = 'block';
        initDashboard();
      } else {
        showLoginError("Invalid email or password");
      }
    });

    logoutBtn.addEventListener("click", () => {
      dashboard.style.display = 'none';
      loginForm.style.display = 'block';
      document.getElementById("email").value = "";
      document.getElementById("password").value = "";
      loginError.style.display = 'none';
    });

    document.getElementById("email").addEventListener("keypress", (e) => { if (e.key === "Enter") loginBtn.click(); });
    document.getElementById("password").addEventListener("keypress", (e) => { if (e.key === "Enter") loginBtn.click(); });

    function showLoginError(message) {
      loginError.textContent = message;
      loginError.style.display = 'block';
    }

    function initDashboard() {
      const db = firebase.database();
      buildDashboardColumns(db);
      setupMainPumpControl(db);
      setInterval(() => {
        evaluateControlLogic();
      }, 2000);
    }

    function buildDashboardColumns(db) {
        const groups = [
            { id: 'group1', name: 'Group 1', sensors: ['s1', 's2'], actuator: { id: "v1", name: "", relay: "relay1" } },
            { id: 'group2', name: 'Group 2', sensors: ['s3', 's4'], actuator: { id: "v2", name: "", relay: "relay2" } },
            { id: 'group3', name: 'Group 3', sensors: ['s5', 's6'], actuator: { id: "v3", name: "", relay: "relay3" } }
        ];

        // Clear columns before building
        document.getElementById('col-group1').innerHTML = '';
        document.getElementById('col-group2').innerHTML = '';
        document.getElementById('col-group3').innerHTML = '';

        // Build columns for each group
        groups.forEach(group => {
            const groupNumber = group.id.slice(-1);
            const column = document.getElementById(`col-${group.id}`);
            
            // Add cards in order
            column.appendChild(createSensorCard(group, db));
            column.appendChild(createSetPointCard(group));
            column.appendChild(createRelayLogicCard(group.actuator.relay, `Valve Grup ${groupNumber}`, ''));
            column.appendChild(createManualOverrideCard(group.actuator, db, `Valve Control Grup ${groupNumber}`));
        });
        
        setupGlobalControls(db, groups.map(g => g.actuator));
        updateSetPointDisplay();
    }

    function setupMainPumpControl(db) {
        const mainPump = { id: 'm', name: 'Main Pump', relay: 'relay4' };
        const control = document.getElementById('m-control');
        const statusEl = document.getElementById('m-status');
        const ref = db.ref(`/actuators/${mainPump.id}`);

        ref.on("value", snap => {
            const state = snap.val();
            relayStates[mainPump.relay] = state;
            if (statusEl) {
                statusEl.innerText = state ? "ON" : "OFF";
                statusEl.className = state ? "text-green-600 font-bold" : "text-red-600 font-bold";
            }
            if (control) control.checked = state;
            evaluateControlLogic();
        });
        
        control.onchange = function() { 
            control.dataset.manualOverride = 'true';
            setTimeout(() => {
                delete control.dataset.manualOverride;
            }, 1000);
            ref.set(this.checked); 
        };
    }

    function createSensorCard(group, db) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<h4 class="font-semibold mb-3 text-center text-gray-700 text-sm sm:text-base">Sensor Monitoring</h4><div class="space-y-2 sm:space-y-3">${group.sensors.map(sensor => `<div class="flex flex-col"><div class="flex justify-between text-xs sm:text-sm"><span class="text-gray-600">${sensor.toUpperCase()}:</span><span class="font-semibold text-gray-800" id="${sensor}-value">Loading...</span></div><div class="w-full bg-gray-200 rounded-full h-2 sm:h-2.5 mt-1"><div id="${sensor}-bar" class="bg-blue-600 h-2 sm:h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div></div></div>`).join('')}</div><hr class="my-3 sm:my-4"><div class="flex justify-between items-center"><span class="text-xs sm:text-sm font-medium text-gray-500">Avg Moisture:</span><span class="text-sm sm:text-base font-bold text-blue-600" id="${group.id}-avg">0.0%</span></div><div class="flex justify-between items-center"><span class="text-xs sm:text-sm font-medium text-gray-500">Condition:</span><span class="text-xs sm:text-sm font-semibold px-2 py-1 rounded-md" id="${group.id}-condition">FALSE</span></div>`;
        
        group.sensors.forEach(sensorId => {
            db.ref(`/sensors/${sensorId}`).on("value", snap => {
                const val = parseFloat(snap.val() || 0);
                sensorData[sensorId] = val;
                document.getElementById(`${sensorId}-value`).innerText = val.toFixed(1) + '%';
                const bar = document.getElementById(`${sensorId}-bar`);
                bar.style.width = val + '%';
                const red = Math.floor(255 * (1 - val / 100));
                const green = Math.floor(255 * (val / 100));
                bar.style.backgroundColor = `rgb(${red}, ${green}, 0)`;
                updateGroupAverage(group);
            });
        });
        return card;
    }

    function createSetPointCard(group) {
        const groupNumber = group.id.slice(-1);
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <h4 class="font-semibold mb-3 sm:mb-4 text-center text-gray-700 text-sm sm:text-base">Set Poin Grup ${groupNumber}</h4>
            <div class="setpoint-container">
                <div class="setpoint-label">Target Moisture Level</div>
                <div class="setpoint-value" id="${group.id}-value">${setPointValues[group.id].toFixed(1)}%</div>
                <div class="setpoint-controls">
                    <button class="setpoint-btn decrease" onclick="updateSetpoint('${group.id}', -1)">−</button>
                    <input type="range" min="0" max="100" value="${setPointValues[group.id]}" class="setpoint-slider" id="${group.id}-slider">
                    <button class="setpoint-btn increase" onclick="updateSetpoint('${group.id}', 1)">+</button>
                </div>
            </div>
        `;
        
        const slider = card.querySelector(`#${group.id}-slider`);
        slider.oninput = (e) => {
            setPointValues[group.id] = parseInt(e.target.value);
            updateSetPointDisplay();
        };
        
        slider.addEventListener('input', () => {
            slider.classList.add('glow-active');
            setTimeout(() => slider.classList.remove('glow-active'), 1000);
        });
        
        return card;
    }

    function createRelayLogicCard(relayId, title, description, customClass = '') {
        const card = document.createElement("div");
        card.className = `card text-center ${customClass}`;
        card.innerHTML = `<h4 class="font-semibold mb-2 text-center text-gray-700 text-sm sm:text-base">${title}</h4><p class="text-xs sm:text-sm text-gray-500 mb-3">${description}</p><div class="mt-auto"><div class="text-sm sm:text-lg font-semibold px-2 sm:px-3 py-1 rounded-md inline-block" id="${relayId}-status">OFF</div><div class="text-xs mt-2 text-gray-500" id="${relayId}-reason">Initializing...</div></div>`;
        return card;
    }

    function createManualOverrideCard(actuator, db, title, customClass = '') {
        const card = document.createElement("div");
        card.className = `card text-center ${customClass}`;
        card.innerHTML = `<h4 class="font-semibold mb-2 text-center text-gray-700 text-sm sm:text-base">${title}</h4><p class="text-xs sm:text-sm text-gray-500 mb-3">${actuator.name}</p><div class="mt-auto"><p class="mb-3 text-xs sm:text-sm">Status: <span id="${actuator.id}-status" class="font-bold">Loading...</span></p><label class="switch mx-auto"><input type="checkbox" id="${actuator.id}-control"><span class="slider"></span></label></div>`;
        
        const control = card.querySelector(`#${actuator.id}-control`);
        const statusEl = card.querySelector(`#${actuator.id}-status`);
        const ref = db.ref(`/actuators/${actuator.id}`);

        ref.on("value", snap => {
            const state = snap.val();
            relayStates[actuator.relay] = state;
            if (statusEl) {
                statusEl.innerText = state ? "ON" : "OFF";
                statusEl.className = state ? "text-green-600 font-bold" : "text-red-600 font-bold";
            }
            if (control) control.checked = state;
            evaluateControlLogic();
        });
        
        control.onchange = function() { 
            ref.set(this.checked); 
        };
        
        return card;
    }

    function setupGlobalControls(db, allActuators) {
        const mainPump = { id: 'm', name: 'Main Pump', relay: 'relay4' };
        const allDevices = [...allActuators, mainPump];
        
        document.getElementById("allOffBtn").onclick = () => { 
            allDevices.forEach(actuator => db.ref(`/actuators/${actuator.id}`).set(false)); 
        };
        document.getElementById("allOnBtn").onclick = () => { 
            allDevices.forEach(actuator => db.ref(`/actuators/${actuator.id}`).set(true)); 
        };
    }

    function updateGroupAverage(group) {
        const sensorValues = group.sensors.map(id => sensorData[id] || 0);
        const avgMoisture = sensorValues.length > 0 ? sensorValues.reduce((a, b) => a + b, 0) / sensorValues.length : 0;
        document.getElementById(`${group.id}-avg`).innerText = avgMoisture.toFixed(1) + '%';
        const conditionElement = document.getElementById(`${group.id}-condition`);
        const needsWater = setPointValues[group.id] > avgMoisture;
        conditionElement.innerText = needsWater ? 'TRUE' : 'FALSE';
        conditionElement.className = `text-xs sm:text-sm font-semibold px-2 py-1 rounded-md ${needsWater ? 'logic-true' : 'logic-false'}`;
    }

    function updateSetpoint(groupId, change) {
        setPointValues[groupId] = Math.max(0, Math.min(100, setPointValues[groupId] + change));
        updateSetPointDisplay();
        
        const valueElement = document.getElementById(`${groupId}-value`);
        valueElement.classList.add('glow-active');
        setTimeout(() => valueElement.classList.remove('glow-active'), 500);
    }

    function updateSetPointDisplay() {
        Object.keys(setPointValues).forEach(groupKey => {
            document.getElementById(`${groupKey}-value`).innerText = setPointValues[groupKey].toFixed(1) + '%';
            document.getElementById(`${groupKey}-slider`).value = setPointValues[groupKey];
        });
        evaluateControlLogic();
    }
    
    function evaluateControlLogic() {
        const groups = [ { id: 'group1', relay: 'relay1' }, { id: 'group2', relay: 'relay2' }, { id: 'group3', relay: 'relay3' }];
        let anyValveActive = false;

        groups.forEach(group => {
            const avgElement = document.getElementById(`${group.id}-avg`);
            if (!avgElement) return;
            const avgMoisture = parseFloat(avgElement.innerText) || 0;
            const needsWater = setPointValues[group.id] > avgMoisture;
            const relayStatus = document.getElementById(`${group.relay}-status`);
            const relayReason = document.getElementById(`${group.relay}-reason`);
            const isManualOn = relayStates[group.relay];
            
            const valveActive = isManualOn || needsWater;
            if (valveActive) {
                anyValveActive = true;
            }

             if (relayStatus && relayReason) {
                if (isManualOn) {
                    relayStatus.textContent = 'ON';
                    relayStatus.className = 'text-lg font-semibold px-3 py-1 rounded-md status-active';
                    relayReason.textContent = 'Manual Override';
                } else if (needsWater) {
                    relayStatus.textContent = 'AUTO ON';
                    relayStatus.className = 'text-lg font-semibold px-3 py-1 rounded-md status-active';
                    relayReason.textContent = `Set Point (${setPointValues[group.id].toFixed(1)}%) > Avg (${avgMoisture.toFixed(1)}%)`;
                } else {
                    relayStatus.textContent = 'OFF';
                    relayStatus.className = 'text-lg font-semibold px-3 py-1 rounded-md status-inactive';
                    relayReason.textContent = `Set Point (${setPointValues[group.id].toFixed(1)}%) ≤ Avg (${avgMoisture.toFixed(1)}%)`;
                }
            }
        });

        const mainPumpControl = document.getElementById('m-control');
        if (mainPumpControl && !mainPumpControl.dataset.manualOverride) {
            const shouldPumpBeOn = anyValveActive;
            if (mainPumpControl.checked !== shouldPumpBeOn) {
                mainPumpControl.checked = shouldPumpBeOn;
                const db = firebase.database();
                db.ref('/actuators/m').set(shouldPumpBeOn);
            }
        }
    }
</script>
</body>
</html>